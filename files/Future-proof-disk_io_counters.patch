From 142c7aff104094fca17d086a6f60f62dbb2b7d29 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Sat, 15 Feb 2020 10:06:19 +0200
Subject: [PATCH 1/1] Future-proof disk_io_counters on Linux.

Patch from psutil git.
---
 third_party/python/psutil/psutil/_pslinux.py | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/third_party/python/psutil/psutil/_pslinux.py b/third_party/python/psutil/psutil/_pslinux.py
index b57adb34e5..2f348231d3 100644
--- a/third_party/python/psutil/psutil/_pslinux.py
+++ b/third_party/python/psutil/psutil/_pslinux.py
@@ -1051,6 +1051,7 @@ def disk_io_counters():
         # ...unless (Linux 2.6) the line refers to a partition instead
         # of a disk, in which case the line has less fields (7):
         # "3    1   hda1 8 8 8 8"
+        # 5.5 has 2 more fields
         # See:
         # https://www.kernel.org/doc/Documentation/iostats.txt
         # https://www.kernel.org/doc/Documentation/ABI/testing/procfs-diskstats
@@ -1062,7 +1063,7 @@ def disk_io_counters():
             reads = int(fields[2])
             (reads_merged, rbytes, rtime, writes, writes_merged,
                 wbytes, wtime, _, busy_time, _) = map(int, fields[4:14])
-        elif fields_len == 14:
+        elif fields_len == 14 or flen >=18:
             # Linux 2.6+, line referring to a disk
             name = fields[2]
             (reads, reads_merged, rbytes, rtime, writes, writes_merged,
-- 
2.25.0

