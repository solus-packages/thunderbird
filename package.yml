name       : thunderbird
version    : 60.4.0
release    : 65
source     :
    - https://ftp.mozilla.org/pub/thunderbird/releases/60.4.0/source/thunderbird-60.4.0.source.tar.xz : 27a6cdd9cfdd7ce70b1d193c64739db6be6b39eec308f0122d8472a6cd243e75
    - https://getsol.us/sources/mozilla/thunderbird-60.4.0-langpacks.tar.xz : fd89d7b56a4c877fc57583538a79175d6cc9c02fcf6db229a4c1eb7b4f79e9f9
    - https://getsol.us/sources/mozilla/thunderbird-60.4.0-lightning-langpacks.tar.xz : 55f287c40be989b80b79a9ac18086cb0e04b9b234b38bf5d9eb40d2c971dee10
license    :
    - GPL-2.0-or-later
    - LGPL-2.1-or-later
    - MPL-2.0
component  : network.mail
clang      : yes
networking : yes
summary    : Thunderbird Email Client
description: |
    Thunderbird is a free email application that’s easy to set up and customize - and it’s loaded with great features!
builddeps  :
    - pkgconfig(alsa)
    - pkgconfig(atk)
    - pkgconfig(cairo)
    - pkgconfig(dbus-glib-1)
    - pkgconfig(gconf-2.0)
    - pkgconfig(gstreamer-plugins-base-1.0)
    - pkgconfig(gtk+-2.0)
    - pkgconfig(gtk+-3.0)
    - pkgconfig(hunspell)
    - pkgconfig(libevent)
    - pkgconfig(libffi)
    - pkgconfig(libjpeg)
    - pkgconfig(libpulse)
    - pkgconfig(libstartup-notification-1.0)
    - pkgconfig(nss)
    - pkgconfig(pixman-1)
    - pkgconfig(x11)
    - pkgconfig(xcomposite)
    - pkgconfig(xt)
    - autoconf213
    - cargo
    - llvm-clang
    - yasm
setup      : |
    cp $pkgfiles/mozilla-api-key .
    cp $pkgfiles/config mozconfig
    sed -e 's|##JOBCOUNT##|%JOBS%|' -e 's|##LIBDIR##|%libdir%|' -i mozconfig

    %patch -p1 < $pkgfiles/thunderbird-enable-addons.patch

    ./mach configure
build      : |
    ./mach build
    ./mach buildsymbols
install    : |
    # Install locales first
    langpackdir="$installdir/%libdir%/thunderbird/extensions"
    install -dm00755 "${langpackdir}"

    tar xf "${sources}/thunderbird-${version}-langpacks.tar.xz"
    tar xf "${sources}/thunderbird-${version}-lightning-langpacks.tar.xz" -C lang_pack

    for i in lang_pack/*.xpi; do
        lname="$(basename ${i})"
        install -m00644 "lang_pack/${lname}" "${langpackdir}/${lname}"
    done

    DESTDIR=$installdir ./mach install

    install -dm00755 $installdir/usr/share/pixmaps
    ln -s %libdir%/thunderbird/chrome/icons/default/default256.png $installdir/usr/share/pixmaps/thunderbird.png
    for i in 16 22 24 32 48 128 256; do
        install -dm00755 $installdir/usr/share/icons/hicolor/${i}x${i}
        ln -s %libdir%/thunderbird/chrome/icons/default/default${i}.png $installdir/usr/share/icons/hicolor/${i}x${i}/thunderbird.png
    done
    install -Dm00644 $pkgfiles/thunderbird.desktop $installdir/usr/share/applications/thunderbird.desktop

    # set up defaults
    install -Dm00644 $pkgfiles/prefs.js $installdir/%libdir%/thunderbird/defaults/pref/prefs.js
